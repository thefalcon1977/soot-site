{% extends 'shared/_site.html' %}
{% load thumbnail %}

{% block body %}
  <section class="page-wrapper">
    <div class="container">
      <div class="row">
        <!-- Post Content -->

        <div class="col-lg-8 col-xl-8">
          <div class="post-single">
            <!-- Post Thumbnail -->
            <div class="post-thumb position-relative">
              {% if post.video %}
                <!-- Video Player with percentage width -->
                <video id="postVideo" class="d-none" controls preload="metadata" style="width: 800px; height: 450px; max-width: 100%;">
                  <source src="{{ post.video.url }}" type="video/mp4" />
                  <source src="{{ post.video.url }}" type="video/webm" />
                  <source src="{{ post.video.url }}" type="video/ogg" />Your browser does not support the video tag.
                </video>

                <!-- Banner Image with Play Button Overlay -->
                <div id="bannerContainer" class="position-relative" style="cursor: pointer;">
                  {% thumbnail post.banner '1170x600' crop='center' format='WEBP' as im %}
                  <img src="{{ im.url }}" class="img-fluid" alt="{{ post.alternate_text }}" />
                  {% endthumbnail %}

                  <!-- Play Button Overlay -->
                  <div class="play-button-overlay position-absolute d-flex align-items-center justify-content-center" style="top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); transition: all 0.3s ease;">
                    <div class="play-button bg-white rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; font-size: 24px; color: #333; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">
                      <i class="fa fa-play" style="margin-left: 4px;"></i>
                    </div>
                  </div>
                </div>
              {% else %}
                <!-- Regular Banner Image (no video) -->
                {% thumbnail post.banner '1170x600' crop='center' format='WEBP' as im %}
                <img src="{{ im.url }}" class="img-fluid" alt="{{ post.alternate_text }}" />
                {% endthumbnail %}
              {% endif %}
            </div>

            {% if post.video %}
              <script>
                document.addEventListener('DOMContentLoaded', function () {
                  const bannerContainer = document.getElementById('bannerContainer')
                  const video = document.getElementById('postVideo')
                  const playOverlay = document.querySelector('.play-button-overlay')
                
                  // Handle banner click to play video
                  bannerContainer.addEventListener('click', function () {
                    bannerContainer.style.display = 'none'
                    video.classList.remove('d-none')
                    video.play()
                  })
                
                  // Handle video end to show banner again
                  video.addEventListener('ended', function () {
                    video.classList.add('d-none')
                    bannerContainer.style.display = 'block'
                  })
                
                  // Optional: Handle video pause to show banner again
                  video.addEventListener('pause', function () {
                    if (video.currentTime === 0) {
                      video.classList.add('d-none')
                      bannerContainer.style.display = 'block'
                    }
                  })
                
                  // Hover effects for play button
                  bannerContainer.addEventListener('mouseenter', function () {
                    playOverlay.style.background = 'rgba(0,0,0,0.5)'
                  })
                
                  bannerContainer.addEventListener('mouseleave', function () {
                    playOverlay.style.background = 'rgba(0,0,0,0.3)'
                  })
                })
              </script>
            {% endif %}

            <!-- Post Metadata -->
            <div class="single-post-content">
              <div class="post-meta">
                <span class="post-date">
                  <i class="fa fa-calendar-alt mr-2"></i>
                  {{ post.created_at|date:'F d, Y' }}
                </span>
              </div>
              <h3 class="post-title">{{ post.title }}</h3>
              <p>{{ post.summary }}</p>

              {{ post }}

              <!-- Post Description -->
              <div class="post-content">{{ post.description|safe }}</div>
            </div>

            <!-- Post Tags & Share -->
            <div class="blog-footer-meta d-md-flex justify-content-between align-items-center">
              <div class="post-tags mb-4 mb-md-0">
                {% for tag in post.tags.all %}
                  <a href="{% url 'pages:blog-post-list' %}?tag={{ tag.slug }}">{{ tag.title }}</a>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>

        <!-- Related Posts Section -->
        {% if post.related_posts.exists %}
          <div class="col-lg-12 mt-5">
            <h2 class="mb-3">{% trans 'Related Posts' %}</h2>
            <div class="row">
              {% for related_post in post.related_posts.all %}
                <div class="col-md-4">
                  <div class="blog-item">
                    <div class="post-thumb">
                      <a href="{% url 'pages:blog-post-detail' related_post.slug %}">
                        {% thumbnail related_post.picture '352x252' crop='center' format='WEBP' as im %}
                        <img src="{{ im.url }}" class="img-fluid" alt="{{ related_post.alternate_text }}" />
                        {% endthumbnail %}
                      </a>
                    </div>
                    <div class="blog-content">
                      <h5 class="post-title"><a href="{% url 'pages:blog-post-detail' related_post.slug %}">{{ related_post.title }}</a></h5>
                      <span class="post-date">
                        <i class="fa fa-calendar-alt mr-2"></i>
                        {{ related_post.created_at|date:'F d, Y' }}
                      </span>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}

        <!-- Recent Posts Section -->
        {% if blog_recent_posts %}
          <div class="col-lg-12 mt-5">
            <h2 class="mb-3">{% trans 'Recent Posts' %}</h2>
            <div class="row">
              {% for recent_post in blog_recent_posts %}
                <div class="col-md-4">
                  <div class="blog-item">
                    <div class="post-thumb">
                      <a href="{% url 'pages:blog-post-detail' recent_post.slug %}">
                        {% thumbnail recent_post.picture '352x252' crop='center' format='WEBP' as im %}
                        <img src="{{ im.url }}" class="img-fluid" alt="{{ recent_post.alternate_text }}" />
                        {% endthumbnail %}
                      </a>
                    </div>
                    <div class="blog-content">
                      <h5 class="post-title"><a href="{% url 'pages:blog-post-detail' recent_post.slug %}">{{ recent_post.title }}</a></h5>
                      <span class="post-date">
                        <i class="fa fa-calendar-alt mr-2"></i>
                        {{ recent_post.created_at|date:'F d, Y' }}
                      </span>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock %}
